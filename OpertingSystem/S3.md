# 进程管理

## 进程的概念

- 程序: 算法 + 指令 + 数据
- 单道系统：顺序执行
  - 顺序性 封闭性 可再现性
- 多道系统：
  - 交叉性 开放性 不可再现性
- 程序并发
  - 宏观 同时推进
  - 微观 分时的
- 程序并行
  - 微观同时推进

- 进程的定义
  - 是一个正在参与并发执行的程序
    - 数据\程序\进程控制块(PCB)
- 程序执行 $\neq$ 进程执行
- 进程 动态 并发 多对一(程序)

- 特征
  - 动态
  - 并发
  - 独立: 分配资源的基本单位
  - 异步
  - 结构
    - 数据\程序\进程控制块(PCB)
  
## 进程的描述 - PCB

- 系统感知进程存在的唯一标志
- 进程与PCB一一对应
- 内容
  - 信息
    - 进程标识符
    - 用户标识符
    - 家族关系
  - 控制信息
  - 资源管理信息
  - CPU现场保护结构
    - 寄存器值
    - 指向赋予该进程的段/页的指针
- 进程空间
  - 系统空间
  - 用户空间
- 进程状态
  - 就绪状态(Ready)
  - 运行状态(Running)
    - 运行队列大小与cpu数量有关
  - 阻塞状态(Wait/Blocked)
  - 就绪$⇆$运行$→$阻塞$→$就绪
- 进程控制
  - 具有特定功能的程序段进行进程控制
  - 使用`原语`来实现
  - 原语
    - 执行时不可中断的指令单位
    - 机器指令级
    - 功能级
  - 进程创建
    - 系统程序模块统一创建
    - 父进程创建
    - 进入就绪队列
      - 不能进入等待队列
        - 无法唤醒
      - 不能进入运行队列
        - cpu被占用
  - 进程撤销
    - 完成功能正常终止
    - 由于错误非正常终止
    - 祖先进程要求撤销
    - 要求逐层撤销子进程
  - 阻塞
    - 调用阻塞原语阻塞自己
    - 进程主动行为
  - 唤醒
    - 必须由其合作进程使用唤醒原语唤醒
- 进程互斥
  - 基本概念
    - 临界资源 `critical resource`
      - 一次仅允许一个进程访问 
    - 临界区 `critical region`
      - 把不允许多个并发进程交叉执行的一段程序成为临界区
    - 互斥
      - 不允许两个需要共享资源的并发进程同时进入临界区称为互斥
    - 互斥准则
      - 并发进程 享有 平等独立竞争
      - 不在临界区的进程不能阻止其他进程进入
      - 每次最多只有一个进程进入临界区
      - 能在有限的时间内进入临界区
    - 对临界区加锁以实现互斥
      - lock(key[S])<br>
        临界区<br>
        unlock(key[S])
    - 信号量
      - 锁机制 多个进程竞争导致同时进入
      - 记录可用资源数 等待使用临界区资源数
      - 仅由P V原语改变
      - 进程无法进入临界区时
        - 锁机制 反复循环测试
        - 信号量 进入等待队列
      - 类似消息队列的机制
- 进程同步
  - 基本概念
    - 一组进程因为直接制约进行的相互合作,等待使得其按一定速度推进的过程称为进程的同步
    - 这样的一组称为合作进程
    - 相互间发送的信号称为`消息或事件`
      - wait
      - singal
  - 私用信号量
    - 把各进程发送的消息视为信号量,称为`私用信号量`
    - 互斥是的信号量称为`公用信号量`
  - P V原语实现同步
  - 生产者-消费者问题
		- 类似消息队列
  - 通信
    - 进程间通信
      - 低级
        - 传送状态和整数值
        - 速度快
      - 高级
        - 传送各种数据
    - 通信方式
      - 主从式通信
        - 主进程自由使用从进程的资源和数据
        - 从进程受主进程控制
      - 会话式
        - 通信双方
          - 客户进程
          - 服务进程
        - 客户进程得到服务进程许可
        - 服务进程根据客户进程要求完成工作
        - 通信时有固定连接关系
      - 消息或邮箱机制
        - 类似消息队列
        - 无直接连接关系
        - 消息缓冲机制
          - 见p60 3.7.2
        - 邮箱通信
          - 见p61 3.7.3
          - 实例
            - 控制台通信
      - 共享存储区方式
        - 两个需要交换消息的进程共享`同一数据区`
    